import{r as u,T as B,A as j,h as d,d as n,b as o,w as a,F as k,M as q,o as s,a as t,e as S,g as G,t as W,c as E,f,y as M,u as c}from"./app-QC31J3KV.js";const $={key:0,class:"text-lg font-medium text-gray-900"},z={key:1,class:"text-lg font-medium text-gray-900"},I={key:2,class:"text-lg font-medium text-gray-900"},J={key:3},X={key:0},Z=["innerHTML"],ee={key:1},te={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg"},oe={class:"mt-5"},ae={class:"mt-4"},se={class:"mt-4 flex items-center space-x-2"},ne={key:1},re={class:"mt-4"},le={class:"mt-4"},ue={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean,user:Object},setup(N){const C=N,y=u(!1),i=u(!1),x=u(!1),w=u(null),_=u(null),F=u([]),m=B({code:""}),g=j(()=>!y.value&&C.user.two_factor_enabled),p=B({password:""}),h=u(!1),Q=()=>{p.post(route("password.confirm"),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{h.value=!1,T()},onError:()=>{p.reset()}})},T=()=>{y.value=!0,q.post("/user/two-factor-authentication",{},{preserveState:!0,preserveScroll:!0,onSuccess:()=>Promise.all([V(),K(),A()]),onFinish:()=>{y.value=!1,i.value=C.requiresConfirmation},onError:r=>{r.response&&r.response.status===423&&(h.value=!0)}})},V=()=>axios.get("/user/two-factor-qr-code").then(r=>{w.value=r.data.svg}),K=()=>axios.get("/user/two-factor-secret-key").then(r=>{_.value=r.data.secretKey}),A=()=>axios.get("/user/two-factor-recovery-codes").then(r=>{F.value=r.data}),L=()=>{m.post("/user/confirmed-two-factor-authentication",{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{i.value=!1,w.value=null,_.value=null}})},O=()=>{axios.post("/user/two-factor-recovery-codes").then(()=>{A()})},U=()=>{x.value=!0,q.delete("/user/two-factor-authentication",{preserveState:!0,preserveScroll:!0,onSuccess:()=>{x.value=!1,i.value=!1}})};return(r,e)=>{const P=d("a-col"),v=d("a-button"),b=d("a-form"),R=d("a-input-password"),Y=d("a-row"),D=d("a-form-item"),H=d("a-modal");return s(),n(k,null,[o(Y,{gutter:16},{default:a(()=>[o(P,{span:12},{default:a(()=>e[4]||(e[4]=[t("h3",{class:"text-lg font-medium text-gray-900"},"Two Factor Authentication",-1),t("p",{class:"mt-1 text-sm text-gray-600"}," Add additional security to your account using two factor authentication. ",-1)])),_:1}),o(P,{span:12},{default:a(()=>[g.value&&!i.value?(s(),n("h3",$," You have enabled two factor authentication. ")):g.value&&i.value?(s(),n("h3",z," Finish enabling two factor authentication. ")):(s(),n("h3",I," You have not enabled two factor authentication. ")),e[14]||(e[14]=t("div",{class:"mt-3 max-w-xl text-sm text-gray-600"},[t("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1)),g.value?(s(),n("div",J,[w.value?(s(),n("div",X,[e[5]||(e[5]=t("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[t("p",{class:"font-semibold"}," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application. ")],-1)),t("div",{class:"mt-4",innerHTML:w.value},null,8,Z)])):S("",!0),_.value?(s(),n("div",ee,[e[6]||(e[6]=t("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[t("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1)),t("div",te,[(s(!0),n(k,null,G(F.value,l=>(s(),n("div",{key:l},W(l),1))),128))])])):S("",!0)])):S("",!0),t("div",oe,[g.value?(s(),n(k,{key:1},[i.value?(s(),E(b,{key:0,onSubmit:M(L,["prevent"])},{default:a(()=>[e[10]||(e[10]=t("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[t("p",{class:"font-semibold"}," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")],-1)),t("div",ae,[o(R,{value:c(m).code,"onUpdate:value":e[0]||(e[0]=l=>c(m).code=l),placeholder:"Code"},null,8,["value"])]),t("div",se,[o(v,{type:"primary",disabled:c(m).processing,"html-type":"submit"},{default:a(()=>e[8]||(e[8]=[f(" Confirm ")])),_:1},8,["disabled"]),o(v,{disabled:c(m).processing,onClick:e[1]||(e[1]=l=>i.value=!1)},{default:a(()=>e[9]||(e[9]=[f(" Cancel ")])),_:1},8,["disabled"])])]),_:1})):(s(),n("div",ne,[e[13]||(e[13]=t("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[t("p",{class:"font-semibold"}," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. ")],-1)),t("div",re,[o(v,{type:"primary",onClick:O},{default:a(()=>e[11]||(e[11]=[f(" Regenerate Recovery Codes ")])),_:1})]),t("div",le,[o(v,{type:"primary",danger:"",onClick:U,loading:x.value},{default:a(()=>e[12]||(e[12]=[f(" Disable ")])),_:1},8,["loading"])])]))],64)):(s(),E(b,{key:0,onSubmit:M(T,["prevent"])},{default:a(()=>[o(v,{type:"primary",loading:y.value,"html-type":"submit"},{default:a(()=>e[7]||(e[7]=[f(" Enable ")])),_:1},8,["loading"])]),_:1}))])]),_:1})]),_:1}),o(H,{visible:h.value,"onUpdate:visible":e[3]||(e[3]=l=>h.value=l),title:"Confirm Password",onOk:Q},{default:a(()=>[o(b,{model:c(p)},{default:a(()=>[o(D,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}]},{default:a(()=>[o(R,{value:c(p).password,"onUpdate:value":e[2]||(e[2]=l=>c(p).password=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])],64)}}};export{ue as default};
